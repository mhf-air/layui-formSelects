"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e,n){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=n():"function"==typeof define&&define.amd?define(n):e.layui&&t.define?t.define(["jquery"],function(t){t("formSelects",n())}):e.formSelects=n()}("undefined"==typeof layui?null:layui,window,function(){var v="xm-select",m="xm-select-parent",y="xm-select-input",g="xm-select--suffix",C="xm-select-this",x="xm-select-label",k="xm-select-search",b="xm-select-search-type",w="xm-select-skin",S="xm-dis-disabled",T="xm-select-dis",p="xm-select-temp",L="xm-select-radio",j="xm-select-linkage",A="xm-select-dl",h="xm-select-hide",E="xm-hide-input",N="xm-select-sj",D="xm-select-title",H="xm-form-select",d="xm-form-selected",F="xm-select-none",_="xm-select-empty",O="xm-input",I="xm-dl-input",P="xm-select-tips",V="XM_PID_VALUE",U="xm-cz",i="xm-cz-group",e="请选择",M={},W={on:{},endOn:{},filter:{},maxTips:{},opened:{},closed:{}},J={type:"get",header:{},first:!0,data:{},searchUrl:"",searchName:"keyword",searchVal:null,keyName:"name",keyVal:"value",keySel:"selected",keyDis:"disabled",keyChildren:"children",dataType:"",delay:500,beforeSuccess:null,success:null,error:null,beforeSearch:null,response:{statusCode:0,statusName:"code",msgName:"msg",dataName:"data"},tree:{nextClick:function(t,e,n){n([])},folderChoose:!0,lazy:!0}},n=[{icon:"xm-iconfont icon-quanxuan",name:"全选",click:function(t,e){e.selectAll(t,!0,!0)}},{icon:"xm-iconfont icon-qingkong",name:"清空",click:function(t,e){e.removeAll(t,!0,!0)}},{icon:"xm-iconfont icon-fanxuan",name:"反选",click:function(t,e){e.reverse(t,!0,!0)}},{icon:"xm-iconfont icon-pifu",name:"换肤",click:function(t,e){e.skin(t)}}],B=window.$||window.layui&&window.layui.jquery,l=B(window),R={},c={},r={},q=function(t){var o=this;this.config={name:null,max:null,maxTips:function(t,e,n,a){var c=B('[xid="'.concat(o.config.name,'"]')).prev().find(".".concat(v));c.parents(".layui-form-item[pane]").length&&(c=c.parents(".layui-form-item[pane]")),c.attr("style","border-color: red !important"),setTimeout(function(){c.removeAttr("style")},300)},init:null,on:null,opened:null,closed:null,filter:function(t,e,n,a){return-1==n.name.indexOf(e)},clearid:-1,direction:"auto",height:null,isEmpty:!1,btns:[n[0],n[1],n[2]],searchType:0,create:function(t,e){return Date.now()},template:function(t,e){return e.name},showCount:0,isCreate:!1,placeholder:e,clearInput:!1},this.select=null,this.values=[],B.extend(this.config,t,{searchUrl:t.isSearch?t.searchUrl:null,placeholder:t.optionsFirst?t.optionsFirst.value?e:t.optionsFirst.innerHTML||e:e,btns:t.radio?[n[1]]:[n[0],n[1],n[2]]},r[t.name]||c),(isNaN(this.config.showCount)||this.config.showCount<=0)&&(this.config.showCount=19921012)},t=function(){this.appender(),this.on(),this.onreset()};t.prototype.appender=function(){Array.prototype.map||(Array.prototype.map=function(t,e){var n,a,c,o=Object(this),i=o.length>>>0;for(e&&(n=e),a=new Array(i),c=0;c<i;){var r,l;c in o&&(r=o[c],l=t.call(n,r,c,o),a[c]=l),c++}return a}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,a;if(null==this)throw new TypeError("this is null or not defined");var c=Object(this),o=c.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(1<arguments.length&&(n=e),a=0;a<o;){var i;a in c&&(i=c[a],t.call(n,i,a,c)),a++}}),Array.prototype.filter||(Array.prototype.filter=function(t){if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var a=[],c=arguments[1],o=0;o<n;o++)if(o in e){var i=e[o];t.call(c,i,o,e)&&a.push(i)}return a})},t.prototype.init=function(t){var h=this;B(t||"select[".concat(v,"]")).each(function(t,e){var n=B(e),a=n.attr(v),c=n.next(".layui-form-select"),o=n.next(".".concat(m)),i={name:a,disabled:e.disabled,max:n.attr("xm-select-max")-0,isSearch:null!=n.attr(k),searchUrl:n.attr(k),isCreate:null!=n.attr("xm-select-create"),radio:null!=n.attr(L),skin:n.attr(w),direction:n.attr("xm-select-direction"),optionsFirst:e.options[0],height:n.attr("xm-select-height"),formname:n.attr("name")||n.attr("_name"),layverify:n.attr("lay-verify")||n.attr("_lay-verify"),layverType:n.attr("lay-verType"),searchType:"dl"==n.attr(b)?1:0,showCount:n.attr("xm-select-show-count")-0},r=n.find("option[selected]").toArray().map(function(t){return{name:t.innerHTML,value:t.value}}),l=new q(i);l.values=r,l.config.init?(l.values=l.config.init.map(function(t){return"object"==_typeof(t)?t:{name:n.find('option[value="'.concat(t,'"]')).text(),value:t}}).filter(function(t){return t.name}),l.config.init=l.values.concat([])):l.config.init=r.concat([]),!l.values&&(l.values=[]),M[a]=l,c[0]&&c.remove(),o[0]&&o.remove();var s=h.renderSelect(a,l.config.placeholder,e),d=l.config.height&&"auto"!=l.config.height?'xm-hg style="height: 34px;"':"",f=['<div class="'.concat(x,'">'),'<input type="text" fsw class="'.concat(O," ").concat(y,'" ').concat(l.config.isSearch?"":'style="display: none;"',' autocomplete="off" debounce="0" />'),"</div>"],u=B('<div class="'.concat(H,'" ').concat(w,'="').concat(l.config.skin,'">\n\t\t\t\t\t<input class="').concat(E,'" value="" name="').concat(l.config.formname,'" lay-verify="').concat(l.config.layverify,'" lay-verType="').concat(l.config.layverType,'" type="text" style="position: absolute;bottom: 0; z-index: -1;width: 100%; height: 100%; border: none; opacity: 0;"/>\n\t\t\t\t\t<div class="').concat(D," ").concat(l.config.disabled?T:"",'">\n\t\t\t\t\t\t<div class="').concat(O," ").concat(v,'" ').concat(d,">\n\t\t\t\t\t\t\t").concat(f.join(""),'\n\t\t\t\t\t\t\t<i class="').concat(N,'"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="').concat(g,'">\n\t\t\t\t\t\t\t<input type="text" autocomplete="off" placeholder="').concat(l.config.placeholder,'" readonly="readonly" unselectable="on" class="').concat(O,'">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<dl xid="').concat(a,'" class="').concat(A," ").concat(l.config.radio?L:"",'">').concat(s,"</dl>\n\t\t\t\t</div>")),p=B('<div class="'.concat(m,'" FS_ID="').concat(a,'"></div>'));p.append(u),n.after(p),n.attr("lay-ignore",""),n.removeAttr("name")&&n.attr("_name",l.config.formname),n.removeAttr("lay-verify")&&n.attr("_lay-verify",l.config.layverify),l.config.isSearch?(R[a]=B.extend({},J,{searchUrl:l.config.searchUrl},R[a]),B(document).on("input","div.".concat(m,'[FS_ID="').concat(a,'"] .').concat(y),function(t){h.search(a,t,l.config.searchUrl)}),l.config.searchUrl&&h.triggerSearch(u,!0)):u.find("dl dd.".concat(I)).css("display","none")})},t.prototype.search=function(c,t,e,n){var a,o=this;if(n)a=n;else{a=t.target;var i=t.keyCode;if(9===i||13===i||37===i||38===i||39===i||40===i)return!1}var r=B.trim(a.value);this.changePlaceHolder(B(a));var l=R[c]?R[c]:J;e=l.searchUrl||e;var s=M[c],d=s.config.isCreate,f=B('dl[xid="'.concat(c,'"]')).parents(".".concat(H));if(e){if(l.searchVal&&(r=l.searchVal,l.searchVal=""),!l.beforeSearch||l.beforeSearch&&l.beforeSearch instanceof Function&&l.beforeSearch(c,e,r)){var u=l.delay;l.first&&(l.first=!1,u=10),clearTimeout(s.clearid),s.clearid=setTimeout(function(){f.find("dl > *:not(.".concat(P,")")).remove(),f.find("dd.".concat(F)).addClass(_).text("请求中"),o.ajax(c,e,r,!1,null,!0)},u)}}else f.find("dl .".concat(h)).removeClass(h),f.find("dl dd:not(.".concat(P,")")).each(function(t,e){var n=B(e),a=W.filter[c]||M[c].config.filter;a&&1==a(c,r,o.getItem(c,n),n.hasClass(S))&&n.addClass(h)}),f.find("dl dt").each(function(t,e){B(e).nextUntil("dt",":not(.".concat(h,")")).length||B(e).addClass(h)}),this.create(c,d,r),f.find("dl dd:not(.".concat(P,"):not(.").concat(h,")")).length?f.find("dd.".concat(F)).removeClass(_):f.find("dd.".concat(F)).addClass(_).text("无匹配项")},t.prototype.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)},t.prototype.triggerSearch=function(t,a){var c=this;(t?[t]:B(".".concat(H)).toArray()).forEach(function(t,e){var n=(t=B(t)).find("dl").attr("xid");(n&&M[n]&&M[n].config.isEmpty||a)&&c.search(n,null,null,0==M[n].config.searchType?t.find(".".concat(x," .").concat(y)):t.find("dl .".concat(I," .").concat(y)))})},t.prototype.clearInput=function(t){var e=B(".".concat(m,'[fs_id="').concat(t,'"]'));(0==M[t].config.searchType?e.find(".".concat(x," .").concat(y)):e.find("dl .".concat(I," .").concat(y))).val("")},t.prototype.ajax=function(n,a,c,o,i,r,l,s){var d=this,f=B(".".concat(m,' dl[xid="').concat(n,'"]')).parents(".".concat(H));if(f[0]&&a){var u=R[n]?R[n]:J,t=B.extend(!0,{},u.data);t[u.searchName]=c,B.ajax({type:u.type,headers:u.header,url:a,data:"json"==u.dataType?JSON.stringify(t):t,success:function(t){if("string"==typeof t&&(t=JSON.parse(t)),u.beforeSuccess&&u.beforeSuccess instanceof Function&&(t=u.beforeSuccess(n,a,c,t)),d.isArray(t)){var e={};e[u.response.statusName]=u.response.statusCode,e[u.response.msgName]="",e[u.response.dataName]=t,t=e}t[u.response.statusName]!=u.response.statusCode?f.find("dd.".concat(F)).addClass(_).text(t[u.response.msgName]):(f.find("dd.".concat(F)).removeClass(_),d.renderData(n,t[u.response.dataName],o,i,r,s),M[n].config.isEmpty=0==t[u.response.dataName].length),l&&l(n),u.success&&u.success instanceof Function&&u.success(n,a,c,t)},error:function(t){f.find("dd[lay-value]:not(.".concat(P,")")).remove(),f.find("dd.".concat(F)).addClass(_).text("服务异常"),u.error&&u.error instanceof Function&&u.error(n,a,c,t)}})}},t.prototype.renderData=function(n,t,e,a,c,o){var i=this;if(e)this.renderLinkage(n,t,a);else if(o)this.renderReplace(n,t);else{var r=B(".".concat(m,' dl[xid="').concat(n,'"]')).parents(".".concat(H)),l=R[n]?R[n]:J,s=r.find(".".concat(g," input"));t=this.exchangeData(n,t);var d=[];r.find("dl").html(this.renderSelect(n,s.attr("placeholder")||s.attr("back"),t.map(function(t){var e=B.extend({},t,{innerHTML:t[l.keyName],value:t[l.keyVal],sel:t[l.keySel],disabled:t[l.keyDis],type:t.type,name:t[l.keyName]});return e.sel&&d.push(e),e})));var f=r.find(".".concat(x)),u=r.find("dl[xid]");if(c){var p=M[n].values;p.forEach(function(t,e){u.find('dd[lay-value="'.concat(t.value,'"]')).addClass(C)}),d.forEach(function(t,e){-1==i.indexOf(p,t)&&(i.addLabel(n,f,t),u.find('dd[lay-value="'.concat(t.value,'"]')).addClass(C),p.push(t))})}else d.forEach(function(t,e){i.addLabel(n,f,t),u.find('dd[lay-value="'.concat(t.value,'"]')).addClass(C)}),M[n].values=d;this.commonHandler(n,f)}},t.prototype.renderLinkage=function(i,t,n){var e=[],a=0,r={0:t},l=R[i]?R[i]:J;z[i]={};for(var c=function(){var o=e[a++]=[],t=r;r={},B.each(t,function(c,t){B.each(t,function(t,e){var n={pid:c,name:e[l.keyName],value:e[l.keyVal]};z[i][n.value]=B.extend(e,n),o.push(n);var a=e[l.keyChildren];a&&a.length&&(r[n.value]=a)})})};c(),Object.getOwnPropertyNames(r).length;);var o=B(".".concat(m,' dl[xid="').concat(i,'"]')).parents(".".concat(H)),s=['<div class="xm-select-linkage">'];B.each(e,function(t,e){var a=['<div style="left: '.concat((n-0)*t,'px;" class="xm-select-linkage-group xm-select-linkage-group').concat(t+1," ").concat(0!=t?"xm-select-linkage-hide":"",'">')];B.each(e,function(t,e){var n='<li title="'.concat(e.name,'" pid="').concat(e.pid,'" xm-value="').concat(e.value,'"><span>').concat(e.name,"</span></li>");a.push(n)}),a.push("</div>"),s=s.concat(a)}),s.push('<div style="clear: both; height: 288px;"></div>'),s.push("</div>"),o.find("dl").html(s.join("")),o.find(".".concat(y)).css("display","none")},t.prototype.renderReplace=function(n,t){var a=this,e=B(".".concat(m,' dl[xid="').concat(n,'"]')),c=R[n]?R[n]:J;t=this.exchangeData(n,t);var o=(z[n]=t).map(function(t){var e=B.extend({},t,{innerHTML:t[c.keyName],value:t[c.keyVal],sel:t[c.keySel],disabled:t[c.keyDis],type:t.type,name:t[c.keyName]});return a.createDD(n,e)}).join("");e.find("dd:not(.".concat(P,"),dt:not([style])")).remove(),e.find("dt[style]").after(B(o))},t.prototype.exchangeData=function(t,e){var n=R[t]?R[t]:J,a=n.keyChildren,c=n.keyDis;return z[t]={},this.getChildrenList(e,a,c,[],!1)},t.prototype.getChildrenList=function(t,e,n,a,c){for(var o=[],i=0,r=0;r<t.length;r++){var l=t[r];if(l.type&&"optgroup"==l.type)o.push(l);else{i++;var s=a.concat([]);s.push("".concat(i-1,"_E")),l[V]=JSON.stringify(s),l[n]=l[n]||c,o.push(l);var d=l[e];if(d&&X.isArray(d)&&d.length){l.XM_TREE_FOLDER=!0;var f=s.concat([]),u=this.getChildrenList(d,e,n,f,l[n]);o=o.concat(u)}}}return o},t.prototype.create=function(t,e,n){if(e&&n){var a=M[t],c=B('[xid="'.concat(t,'"]')),o=c.find("dd.".concat(P,".").concat(I)),i=null,r=c.find("dd.".concat(p));if(c.find("dd:not(.".concat(P,"):not(.").concat(p,")")).each(function(t,e){n==B(e).find("span").attr("name")&&(i=e)}),!i){var l=a.config.create(t,n);r[0]?(r.attr("lay-value",l),r.find("span").text(n),r.find("span").attr("name",n),r.removeClass(h)):o.after(B(this.createDD(t,{name:n,innerHTML:n,value:l},"".concat(p," ").concat("xm-select-create-long"))))}}else B("[xid=".concat(t,"] dd.").concat(p)).remove()},t.prototype.createDD=function(t,e,n){var a,c=R[t]?R[t]:J,o=B.trim(e.innerHTML);z[t][e.value]=B(e).is("option")?((a={})[c.keyName]=o,a[c.keyVal]=e.value,a[c.keyDis]=e.disabled,e=a):e;var i=M[t].config.template(t,e),r=e[V],l=-1==(r=r?JSON.parse(r):[-1])[0]?"":'tree-id="'.concat(r.join("-"),'" tree-folder="').concat(!!e.XM_TREE_FOLDER,'"');return'<dd lay-value="'.concat(e.value,'" class="').concat(e.disabled?S:""," ").concat(n||"",'" ').concat(l,'>\n\t\t\t\t\t<div class="xm-unselect xm-form-checkbox ').concat(e.disabled?S:"",'"  style="margin-left: ').concat(30*(r.length-1),'px">\n\t\t\t\t\t\t<i class="').concat("xm-iconfont",'"></i>\n\t\t\t\t\t\t<span name="').concat(o,'">').concat(i,"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</dd>")},t.prototype.createQuickBtn=function(t,e){return'<div class="'.concat(U,'" method="').concat(t.name,'" title="').concat(t.name,'" ').concat(e?'style="margin-right: '+e+'"':"",'><i class="').concat(t.icon,'"></i><span>').concat(t.name,"</span></div>")},t.prototype.renderBtns=function(t,e,n){var a=this,c=[],o=B('dl[xid="'.concat(t,'"]'));return c.push('<div class="'.concat(i,'" show="').concat(e,'" style="max-width: ').concat(o.prev().width()-54,'px;">')),B.each(M[t].config.btns,function(t,e){c.push(a.createQuickBtn(e,n))}),c.push("</div>"),c.push(this.createQuickBtn({icon:"xm-iconfont icon-caidan",name:""})),c.join("")},t.prototype.renderSelect=function(n,t,e){var a=this;z[n]={};var c=[];return M[n].config.btns.length?(setTimeout(function(){var t=B('dl[xid="'.concat(n,'"]'));t.parents(".".concat(H)).attr(b,M[n].config.searchType),t.find(".".concat(i)).css("max-width","".concat(t.prev().width()-54,"px"))},10),c.push(['<dd lay-value="" class="'.concat(P,'" style="background-color: #FFF!important;">'),this.renderBtns(n,null,"30px"),"</dd>",'<dd lay-value="" class="'.concat(P," ").concat(I,'" style="background-color: #FFF!important;">'),'<i class="xm-iconfont icon-sousuo"></i>','<input type="text" class="'.concat(O," ").concat(y,'" placeholder="请搜索"/>'),"</dd>"].join(""))):c.push('<dd lay-value="" class="'.concat(P,'">').concat(t,"</dd>")),this.isArray(e)?B(e).each(function(t,e){e&&(e.type&&"optgroup"===e.type?c.push("<dt>".concat(e.name,"</dt>")):c.push(a.createDD(n,e)))}):B(e).find("*").each(function(t,e){("option"!=e.tagName.toLowerCase()||0!=t||e.value)&&("optgroup"===e.tagName.toLowerCase()?c.push("<dt>".concat(e.label,"</dt>")):c.push(a.createDD(n,e)))}),c.push('<dt style="display:none;"> </dt>'),c.push('<dd class="'.concat(P," ").concat(F," ").concat(2===c.length?_:"",'">没有选项</dd>')),c.join("")},t.prototype.on=function(){var n=this;this.one(),B(document).on("click",function(t){B(t.target).parents(".".concat(D))[0]||(B(".".concat(m," dl .").concat(h)).removeClass(h),B(".".concat(m," dl dd.").concat(_)).removeClass(_),B(".".concat(m," dl dd.").concat(p)).remove(),B.each(M,function(t,e){n.clearInput(t),e.values.length||n.changePlaceHolder(B('div[FS_ID="'.concat(t,'"] .').concat(x)))})),B(".".concat(m," .").concat(d)).each(function(t,e){n.changeShow(B(e).find(".".concat(D)),!1)})})},t.prototype.calcLabelLeft=function(t,e,n){var a=this.getPosition(t[0]);a.y=a.x+t[0].clientWidth;var c=t[0].offsetLeft;if(t.find("span").length)if(n){var o=t.find("span:last");o="none"==o.css("display")?o.prev()[0]:o[0];var i=this.getPosition(o);i.y=i.x+o.clientWidth,c=i.y>a.y?c-(i.y-a.y)-5:0}else if(e<0){var r=t.find(":last");r="none"==r.css("display")?r.prev()[0]:r[0];var l=this.getPosition(r);l.y=l.x+r.clientWidth,l.y>a.y&&(c-=10)}else c<0&&(c+=10),0<c&&(c=0);else c=0;t.css("left",c+"px")},t.prototype.one=function(t){var b=this;B(t||document).off("click",".".concat(D)).on("click",".".concat(D),function(t){var e=B(t.target),n=e.is(D)?e:e.parents(".".concat(D)),a=n.next(),c=a.attr("xid");if(B("dl[xid]").not(a).each(function(t,e){b.clearInput(B(e).attr("xid"))}),B("dl[xid]").not(a).find("dd.".concat(h)).removeClass(h),n.hasClass(T))return!1;if(e.is(".".concat(N))||e.is(".".concat(y,"[readonly]")))return b.changeShow(n,!n.parents(".".concat(H)).hasClass(d)),!1;if(n.find(".".concat(y,":not(readonly)"))[0]){var o=n.find(".".concat(y)),i={x:t.pageX,y:t.pageY},r=b.getPosition(n[0]);for(n.width();i.x>r.x;){if(B(document.elementFromPoint(i.x,i.y)).is(o))return o.focus(),b.changeShow(n,!0),!1;i.x-=50}}if(e.is(".".concat(y)))return b.changeShow(n,!0),!1;if(e.is('i[fsw="'.concat(v,'"]'))){var l=b.getItem(c,e),s=a.find("dd[lay-value='".concat(l.value,"']"));return s.hasClass(S)||b.handlerLabel(c,s,!1,l),!1}return b.changeShow(n,!n.parents(".".concat(H)).hasClass(d)),!1}),B(t||document).off("click","dl.".concat(A)).on("click","dl.".concat(A),function(t){var e=B(t.target);if(e.is(".".concat(j))||e.parents(".".concat(j))[0]){var n=(e=e.is("li")?e:e.parents("li[xm-value]")).parents(".xm-select-linkage-group"),a=e.parents("dl").attr("xid");if(!a)return!1;n.find(".xm-select-active").removeClass("xm-select-active"),e.addClass("xm-select-active"),n.nextAll(".xm-select-linkage-group").addClass("xm-select-linkage-hide");var c=n.next(".xm-select-linkage-group");c.find("li").addClass("xm-select-linkage-hide"),c.find('li[pid="'.concat(e.attr("xm-value"),'"]')).removeClass("xm-select-linkage-hide");var o=[],i=0,r=!e.hasClass("xm-select-this");for(M[a].config.radio&&e.parents(".xm-select-linkage").find(".xm-select-this").removeClass("xm-select-this");o[i++]={name:e.find("span").text(),value:e.attr("xm-value")},(e=e.parents(".xm-select-linkage-group").prev().find('li[xm-value="'.concat(e.attr("pid"),'"]'))).length;);o.reverse();var l={name:o.map(function(t){return t.name}).join("/"),value:o.map(function(t){return t.value}).join("/")};return b.handlerLabel(a,null,r,l),c[0]&&0!=c.find("li:not(.xm-select-linkage-hide)").length&&c.removeClass("xm-select-linkage-hide"),!1}if(e.is("dl"))return!1;if(e.is("dt"))return e.nextUntil("dt").each(function(t,e){(e=B(e)).hasClass(S)||e.hasClass(C)||e.find("i:not(.icon-expand)").click()}),!1;var s=e.is("dd")?e:e.parents("dd"),d=s.parent("dl").attr("xid");if(s.hasClass(S))return!1;if(e.is("i.icon-caidan")){var f=[],u=[];return e.parents("dl").find('dd[tree-folder="true"]').each(function(t,e){null==B(e).attr("xm-tree-hidn")?f.push(e):u.push(e)}),(u.length?u:f).forEach(function(t){return t.click()}),!1}var p=s.attr("tree-id");if(p){if(e.is("i:not(.icon-expand)"))return b.handlerLabel(d,s,!s.hasClass(C)),!1;var h=R[d]||J,v=h.tree,m=s.nextAll('dd[tree-id^="'.concat(p,'"]'));if(m&&m.length){var y=m[0].clientHeight;return y?(b.addTreeHeight(s,y),y=0):(y=s.attr("xm-tree-hidn")||36,s.removeAttr("xm-tree-hidn"),s.find(">i").remove(),m=m.filter(function(t,e){return B(e).attr("tree-id").split("-").length-1==p.split("-").length})),m.animate({height:y},150),!1}if(v.nextClick&&v.nextClick instanceof Function)return v.nextClick(d,b.getItem(d,s),function(t){if(t&&t.length){s.attr("tree-folder","true");var n=[];t.forEach(function(t,e){t.innerHTML=t[h.keyName],t[V]=JSON.stringify(p.split("-").concat([e])),n.push(b.createDD(d,t)),z[d][t[h.keyVal]]=t}),s.after(n.join(""))}else b.handlerLabel(d,s,!s.hasClass(C))}),!1}if(s.hasClass(P)){var g=e.is(".".concat(U))?e:e.parents(".".concat(U));if(!g[0])return!1;var x=g.attr("method"),k=M[d].config.btns.filter(function(t){return t.name==x})[0];return k&&k.click&&k.click instanceof Function&&k.click(d,b),!1}return b.handlerLabel(d,s,!s.hasClass(C)),!1})},t.prototype.addTreeHeight=function(t,a){var c=this,e=t.attr("tree-id"),n=t.nextAll('dd[tree-id^="'.concat(e,'"]'));n.length&&(t.append('<i class="xm-iconfont icon-expand"></i>'),t.attr("xm-tree-hidn",a),n.each(function(t,e){var n=B(e);c.addTreeHeight(n,a)}))};var z={};t.prototype.getItem=function(t,e){if(e instanceof B){if(e.is('i[fsw="'.concat(v,'"]'))){var n=e.parent();return z[t][e]||{name:n.find("font").text(),value:n.attr("value")}}var a=e.attr("lay-value");return z[t][a]?z[t][a]:z[t][a]={name:e.find("span[name]").attr("name"),value:a}}return"string"==typeof e&&-1!=e.indexOf("/")?z[t][e]||{name:this.valToName(t,e),value:e}:z[t][e]},t.prototype.linkageAdd=function(t,e){var n=B('dl[xid="'.concat(t,'"]'));n.find(".xm-select-active").removeClass("xm-select-active");for(var a,c,o=e.value.split("/"),i=0,r=[];a=o[i],(c=n.find(".xm-select-linkage-group".concat(i+1,' li[xm-value="').concat(a,'"]')))[0]&&r.push(c),i++,c.length&&null!=a;);r.length==o.length&&B.each(r,function(t,e){e.addClass("xm-select-this")})},t.prototype.linkageDel=function(t,e){for(var n,a,c=B('dl[xid="'.concat(t,'"]')),o=e.value.split("/"),i=o.length-1;n=o[i],(a=c.find(".xm-select-linkage-group".concat(i+1,' li[xm-value="').concat(n,'"]'))).parent().next().find("li[pid=".concat(n,"].xm-select-this")).length||a.removeClass("xm-select-this"),i--,a.length&&null!=n;);},t.prototype.valToName=function(t,e){var a=B('dl[xid="'.concat(t,'"]')),n=(e+"").split("/");if(!n.length)return null;var c=[];return B.each(n,function(t,e){var n=a.find(".xm-select-linkage-group".concat(t+1,' li[xm-value="').concat(e,'"] span')).text();c.push(n)}),c.length==n.length?c.join("/"):null},t.prototype.commonHandler=function(t,e){e&&e[0]&&(this.checkHideSpan(t,e),this.changePlaceHolder(e),this.retop(e.parents(".".concat(H))),this.calcLabelLeft(e,0,!0),this.setHidnVal(t,e),e.parents(".".concat(D," .").concat(v)).attr("title",M[t].values.map(function(t){return t.name}).join(",")))},t.prototype.initVal=function(t){var r=this,e={};t?e[t]=M[t]:e=M,B.each(e,function(n,t){var e=t.values,a=B('dl[xid="'.concat(n,'"]')).parent(),c=a.find(".".concat(x)),o=a.find("dl");o.find("dd.".concat(C)).removeClass(C);var i=e.concat([]);i.concat([]).forEach(function(t,e){r.addLabel(n,c,t),o.find('dd[lay-value="'.concat(t.value,'"]')).addClass(C)}),t.config.radio&&i.length&&e.push(i[i.length-1]),r.commonHandler(n,c)})},t.prototype.setHidnVal=function(t,e){e&&e[0]&&e.parents(".".concat(m)).find(".".concat(E)).val(M[t].values.map(function(t){return t.value}).join(","))},t.prototype.handlerLabel=function(a,t,e,n,c){var o=B('[xid="'.concat(a,'"]')).prev().find(".".concat(x)),i=t&&this.getItem(a,t),r=M[a].values,l=M[a].config.on||W.on[a],s=M[a].config.endOn||W.endOn[a];n&&(i=n);var d=M[a];if(e&&d.config.max&&d.values.length>=d.config.max){var f=W.maxTips[a]||M[a].config.maxTips;f&&f(a,r.concat([]),i,d.config.max)}else if(!(!c&&l&&l instanceof Function&&0==l(a,r.concat([]),i,e,t&&t.hasClass(S)))){var u=B('dl[xid="'.concat(a,'"]'));e?(t&&t[0]?(t.addClass(C),t.removeClass(p)):u.find(".xm-select-linkage")[0]&&this.linkageAdd(a,i),function(t){for(var e=0;e<r.length;e++){var n=r[e];if(0===i.name.indexOf(n.name)){t.delLabel(a,o,n),t.remove(r,n);break}}}(this),this.addLabel(a,o,i),r.push(i)):(t&&t[0]?t.removeClass(C):u.find(".xm-select-linkage")[0]&&this.linkageDel(a,i),this.delLabel(a,o,i),this.remove(r,i)),o[0]&&(d.config.radio&&this.changeShow(o,!1),o.parents(".".concat(D)).prev().removeClass("layui-form-danger"),d.config.clearInput&&this.clearInput(a),this.commonHandler(a,o),!c&&s&&s instanceof Function&&s(a,r.concat([]),i,e,t&&t.hasClass(S)))}},t.prototype.addLabel=function(t,e,n){if(n){var a='fsw="'.concat(v,'"'),c=[B("<span ".concat(a,' value="').concat(n.value,'"><font ').concat(a,">").concat(n.name,"</font></span>")),B("<i ".concat(a,' class="xm-iconfont icon-close"></i>'))],o=c[0],i=c[1];o.append(i);var r=M[t];r.config.radio&&(r.values.length=0,B('dl[xid="'.concat(t,'"]')).find("dd.".concat(C,':not([lay-value="').concat(n.value,'"])')).removeClass(C),e.find("span").remove()),e.find("input").css("width","50px"),e.find("input").before(o)}},t.prototype.delLabel=function(t,e,n){n&&e.find('span[value="'.concat(n.value,'"]:first')).remove()},t.prototype.checkHideSpan=function(t,e){e.parents(".".concat(v))[0].offsetHeight;e.find("span.xm-span-hide").removeClass("xm-span-hide"),e.find("span[style]").remove();var n=M[t].config.showCount;e.find("span").each(function(t,e){n<=t&&B(e).addClass("xm-span-hide")});var a=e.find("span:eq(".concat(n,")"));a[0]&&a.before(B('<span style="padding-right: 6px;" fsw="'.concat(v,'"> + ').concat(e.find("span").length-n,"</span>")))},t.prototype.retop=function(t){var e=t.find("dl"),n=t.offset().top+t.outerHeight()+5-l.scrollTop(),a=e.outerHeight(),c=t.hasClass("layui-form-selectup")||-1!=e.css("top").indexOf("-")||n+a>l.height()&&a<=n;t=t.find(".".concat(v));var o=M[e.attr("xid")],i=e.parents(".layui-form-pane")[0]&&38<e.prev()[0].clientHeight?14:10;(o&&"up"==o.config.direction||c)&&(c=!0,o&&"down"==o.config.direction&&(c=!1));var r=t[0].offsetTop+t.height()+i;c?e.css({top:"auto",bottom:r+3+"px"}):e.css({top:r+"px",bottom:"auto"})},t.prototype.changeShow=function(t,e){B(".layui-form-selected").removeClass("layui-form-selected");var n=t.parents(".".concat(H)),a=n.hasClass(d),c=n.find("dl").attr("xid");if(B(".".concat(m," .").concat(H)).not(n).removeClass(d),e?(this.retop(n),n.addClass(d),n.find(".".concat(y)).focus(),n.find("dl dd[lay-value]:not(.".concat(P,")")).length||n.find("dl .".concat(F)).addClass(_)):(n.removeClass(d),this.clearInput(c),n.find("dl .".concat(_)).removeClass(_),n.find("dl dd.".concat(h)).removeClass(h),n.find("dl dd.".concat(p)).remove(),c&&M[c]&&M[c].config.isEmpty&&this.triggerSearch(n),this.changePlaceHolder(n.find(".".concat(x)))),e!=a){var o=M[c].config.opened||W.opened[c];e&&o&&o instanceof Function&&o(c);var i=M[c].config.closed||W.closed[c];!e&&i&&i instanceof Function&&i(c)}},t.prototype.changePlaceHolder=function(t){var e=t.parents(".".concat(D));if(e[0]||(e=t.parents("dl").prev()),e[0]){var n=t.parents(".".concat(m)).find("dl[xid]").attr("xid");if(M[n]&&M[n].config.height);else{var a=e.find(".".concat(v))[0].clientHeight;e.css("height",(36<a?a+4:a)+"px");var c=e.parents(".".concat(m)).parent().prev();c.is(".layui-form-label")&&e.parents(".layui-form-pane")[0]&&(a=36<a?a+4:a,e.css("height",a+"px"),c.css({height:a+2+"px",lineHeight:a-18+"px"}))}var o=e.find(".".concat(g," input"));if(!t.find("span:last")[0]&&!e.find(".".concat(y)).val()){var i=o.attr("back");o.removeAttr("back"),o.attr("placeholder",i)}else{var r=o.attr("placeholder");o.removeAttr("placeholder"),o.attr("back",r)}}},t.prototype.indexOf=function(t,e){for(var n=0;n<t.length;n++)if(t[n].value==e||t[n].value==(e?e.value:e)||t[n]==e||JSON.stringify(t[n])==JSON.stringify(e))return n;return-1},t.prototype.remove=function(t,e){var n=this.indexOf(t,e?e.value:e);return-1<n&&(t.splice(n,1),!0)},t.prototype.selectAll=function(a,c,t){var o=this,i=B('[xid="'.concat(a,'"]'));i[0]&&(i.find(".xm-select-linkage")[0]||i.find("dd[lay-value]:not(.".concat(P,"):not(.").concat(C,")").concat(t?":not(."+S+")":"")).each(function(t,e){e=B(e);var n=o.getItem(a,e);o.handlerLabel(a,i.find('dd[lay-value="'.concat(n.value,'"]')),!0,n,!c)}))},t.prototype.removeAll=function(n,a,c){var o=this,i=B('[xid="'.concat(n,'"]'));i[0]&&(i.find(".xm-select-linkage")[0]?M[n].values.concat([]).forEach(function(t,e){for(var n,a,c=t.value.split("/"),o=0;n=c[o++],(a=i.find(".xm-select-linkage-group".concat(o,':not(.xm-select-linkage-hide) li[xm-value="').concat(n,'"]'))).click(),a.length&&null!=n;);}):M[n].values.concat([]).forEach(function(t,e){c&&i.find('dd[lay-value="'.concat(t.value,'"]')).hasClass(S)||o.handlerLabel(n,i.find('dd[lay-value="'.concat(t.value,'"]')),!1,t,!a)}))},t.prototype.reverse=function(a,c,t){var o=this,i=B('[xid="'.concat(a,'"]'));i[0]&&(i.find(".xm-select-linkage")[0]||i.find("dd[lay-value]:not(.".concat(P,")").concat(t?":not(."+S+")":"")).each(function(t,e){e=B(e);var n=o.getItem(a,e);o.handlerLabel(a,i.find('dd[lay-value="'.concat(n.value,'"]')),!e.hasClass(C),n,!c)}))},t.prototype.skin=function(t){var e=["default","primary","normal","warm","danger"],n=e[Math.floor(Math.random()*e.length)];B('dl[xid="'.concat(t,'"]')).parents(".".concat(m)).find(".".concat(H)).attr("xm-select-skin",n),this.check(t)&&this.commonHandler(t,B('dl[xid="'.concat(t,'"]')).parents(".".concat(m)).find(".".concat(x)))},t.prototype.getPosition=function(t){for(var e=0,n=0;null!=t;)e+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;return{x:e,y:n}},t.prototype.onreset=function(){B(document).on("click","[type=reset]",function(t){B(t.target).parents("form").find(".".concat(m," dl[xid]")).each(function(t,e){var n,a=e.getAttribute("xid"),c=B(e),o={};X.removeAll(a),M[a].config.init.forEach(function(t,e){t&&(!o[t]||M[a].config.repeat)&&(n=c.find('dd[lay-value="'.concat(t.value,'"]')))[0]&&(X.handlerLabel(a,n,!0),o[t]=1)})})})},t.prototype.bindEvent=function(n,t,a){t&&t instanceof Function&&(a=t,t=null),a&&a instanceof Function&&(t?M[t]?(M[t].config[n]=a,delete W[n][t]):W[n][t]=a:B.each(M,function(t,e){M[t]?M[t].config[n]=a:W[n][t]=a}))},t.prototype.check=function(t,e){return!!B('dl[xid="'.concat(t,'"]')).length||(B('select[xm-select="'.concat(t,'"]')).length?e?void 0:(this.render(t,B('select[xm-select="'.concat(t,'"]'))),!0):(delete M[t],!1))},t.prototype.render=function(t,e){X.init(e),X.one(B('dl[xid="'.concat(t,'"]')).parents(".".concat(m))),X.initVal(t)},t.prototype.log=function(t){console.log(t)};var a=function(){this.v="4.0.0.0910",this.render()},X=new t;return a.prototype.value=function(n,t,e){if("string"!=typeof n)return[];var a=M[n];if(!X.check(n))return[];if("string"==typeof t||null==t){var c=a.values.concat([])||[];return"val"==t?c.map(function(t){return t.value}):"valStr"==t?c.map(function(t){return t.value}).join(","):"name"==t?c.map(function(t){return t.name}):"nameStr"==t?c.map(function(t){return t.name}).join(","):c}if(X.isArray(t)){var o,i=B('[xid="'.concat(n,'"]')),r={},l=!0;0==e?l=!1:1==e?l=!0:X.removeAll(n),l&&a.values.forEach(function(t,e){r[t.value]=1}),t.forEach(function(t,e){!t||r[t]&&!a.config.repeat||((o=i.find('dd[lay-value="'.concat(t,'"]')))[0]?(X.handlerLabel(n,o,l,null,!0),r[t]=1):X.valToName(n,t)&&(X.handlerLabel(n,o,l,X.getItem(n,t),!0),r[t]=1))})}},a.prototype.on=function(t,e,n){return X.bindEvent(n?"endOn":"on",t,e),this},a.prototype.filter=function(t,e){return X.bindEvent("filter",t,e),this},a.prototype.maxTips=function(t,e){return X.bindEvent("maxTips",t,e),this},a.prototype.opened=function(t,e){return X.bindEvent("opened",t,e),this},a.prototype.closed=function(t,e){return X.bindEvent("closed",t,e),this},a.prototype.config=function(t,n,e){return t&&"object"==_typeof(t)&&(e=1==n,n=t,t=null),n&&"object"==_typeof(n)&&(e&&(n.header||(n.header={}),n.header["Content-Type"]="application/json; charset=UTF-8",n.dataType="json"),t?(R[t]=B.extend(!0,{},R[t]||J,n),!X.check(t)&&this.render(t),M[t]&&n.direction&&(M[t].config.direction=n.direction),M[t]&&n.clearInput&&(M[t].config.clearInput=!0),n.searchUrl&&M[t]&&X.triggerSearch(B(".".concat(m,' dl[xid="').concat(t,'"]')).parents(".".concat(H)),!0)):(B.extend(!0,J,n),B.each(R,function(t,e){B.extend(!0,e,n)}))),this},a.prototype.render=function(t,e){var n;t&&"object"==_typeof(t)&&(e=t,t=null);var a=e?(_defineProperty(n={init:e.init,disabled:e.disabled,max:e.max,isSearch:e.isSearch,searchUrl:e.searchUrl,isCreate:e.isCreate,radio:e.radio,skin:e.skin,direction:e.direction,height:e.height,formname:e.formname,layverify:e.layverify,layverType:e.layverType,showCount:e.showCount,placeholder:e.placeholder,create:e.create,filter:e.filter,maxTips:e.maxTips,on:e.on},"on",e.on),_defineProperty(n,"opened",e.opened),_defineProperty(n,"closed",e.closed),_defineProperty(n,"template",e.template),_defineProperty(n,"clearInput",e.clearInput),n):{};return e&&null!=e.searchType&&(a.searchType="dl"==e.searchType?1:0),t?(r[t]={},B.extend(r[t],M[t]?M[t].config:{},a)):B.extend(c,a),(B("select[".concat(v,'="').concat(t,'"]'))[0]?B("select[".concat(v,'="').concat(t,'"]')):B("select[".concat(v,"]"))).each(function(t,e){var n=e.getAttribute(v);X.render(n,e),setTimeout(function(){return X.setHidnVal(n,B('select[xm-select="'.concat(n,'"] + div.').concat(m," .").concat(x)))},10)}),this},a.prototype.disabled=function(t){var e={};return t?X.check(t)&&(e[t]=M[t]):e=M,B.each(e,function(t,e){B('dl[xid="'.concat(t,'"]')).prev().addClass(T)}),this},a.prototype.undisabled=function(t){var e={};return t?X.check(t)&&(e[t]=M[t]):e=M,B.each(e,function(t,e){B('dl[xid="'.concat(t,'"]')).prev().removeClass(T)}),this},a.prototype.data=function(t,e,n){return t&&e&&n?X.check(t)?(this.value(t,[]),this.config(t,n),"local"==e?X.renderData(t,n.arr,1==n.linkage,n.linkageWidth?n.linkageWidth:"100"):"server"==e&&X.ajax(t,n.url,n.keyword,1==n.linkage,n.linkageWidth?n.linkageWidth:"100")):X.log("id: ".concat(t," not render !!!")):X.log("id: ".concat(t," param error !!!")),this},a.prototype.btns=function(t,r,l){if(t&&X.isArray(t)&&(r=t,t=null),!r||!X.isArray(r))return this;var e={};return t?X.check(t)&&(e[t]=M[t]):e=M,r=r.map(function(t){if("string"==typeof t){if("select"==t)return n[0];if("remove"==t)return n[1];if("reverse"==t)return n[2];if("skin"==t)return n[3]}return t}),B.each(e,function(t,e){e.config.btns=r;var n=B('dl[xid="'.concat(t,'"]')).find(".".concat(P,":first"));if(r.length){var a=l&&l.show&&("name"==l.show||"icon"==l.show)?l.show:"",c=X.renderBtns(t,a,l&&l.space?l.space:"30px");n.html(c)}else{var o=n.parents(".".concat(H)).find(".".concat(g," input")),i=o.attr("placeholder")||o.attr("back");n.html(i),n.removeAttr("style")}}),this},a.prototype.search=function(t,e){return t&&X.check(t)&&(R[t]=B.extend(!0,{},R[t]||J,{first:!0,searchVal:e}),X.triggerSearch(B('dl[xid="'.concat(t,'"]')).parents(".".concat(H)),!0)),this},a.prototype.replace=function(t,e,n){var a=this;if(!t||!e||!n)return X.log("id: ".concat(t," param error !!!")),this;if(!X.check(t,!0))return X.log("id: ".concat(t," not render !!!")),this;var c=this.value(t,"val");this.value(t,[]),this.config(t,n),"local"==e?(X.renderData(t,n.arr,1==n.linkage,n.linkageWidth?n.linkageWidth:"100",!1,!0),this.value(t,c,!0)):"server"==e&&X.ajax(t,n.url,n.keyword,1==n.linkage,n.linkageWidth?n.linkageWidth:"100",!1,function(t){a.value(t,c,!0)},!0)},new a});